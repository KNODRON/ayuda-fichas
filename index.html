<!DOCTYPE html>
<html lang="es">
<head>
    <title>Radar Pasivo - Detecci칩n de Drones</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* Estilo para que el mapa ocupe toda la pantalla */
        #map { 
            height: 100vh;
            width: 100vw;
        }
        /* Estilos b치sicos para el cuerpo y asegurar que no haya m치rgenes no deseados */
        body {
            margin: 0;
            padding: 0;
            overflow: hidden; /* Evita barras de desplazamiento */
        }
    </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // Configuraci칩n inicial del mapa
    const radarLat = -33.447868;
    const radarLng = -70.657196;
    const map = L.map('map').setView([radarLat, radarLng], 15);

    // A침adir la capa de OpenStreetMap al mapa
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Definici칩n de 칤conos para el radar y el dron
    // Se usan URLs de placeholders para asegurar que las im치genes se visualicen.
    const radarIcon = L.icon({
        iconUrl: 'https://placehold.co/36x36/2c5282/ffffff?text=游니',
        iconSize: [36, 36],
        iconAnchor: [18, 18], // Centrar el 칤cono en el punto de coordenadas
        popupAnchor: [0, -18]
    });

    const dronIcon = L.icon({
        iconUrl: 'https://placehold.co/30x30/e53e3e/ffffff?text=游띶',
        iconSize: [30, 30],
        iconAnchor: [15, 15],
        popupAnchor: [0, -15]
    });

    // Colocar el marcador del radar en el mapa
    L.marker([radarLat, radarLng], { icon: radarIcon })
        .addTo(map)
        .bindPopup("游니 Radar Pasivo<br><small>Cuartel</small>");

    // C칤rculo de cobertura general del radar
    L.circle([radarLat, radarLng], {
        radius: 1200, // Radio en metros
        color: '#2ecc71',
        fillColor: '#2ecc71',
        fillOpacity: 0.2
    }).addTo(map).bindPopup("Radio de cobertura: 1.2 km");

    // Funciones auxiliares para la generaci칩n de conos de detecci칩n
    function degToRad(deg) {
        return deg * (Math.PI / 180);
    }

    /**
     * Genera los puntos de un cono de detecci칩n en el mapa.
     * @param {L.LatLng} latlng - Coordenadas del centro del cono (radar).
     * @param {number} angulo - Direcci칩n central del cono en grados (0 = Norte).
     * @param {number} apertura - Apertura del cono en grados.
     * @param {number} radio - Radio de alcance en metros.
     * @returns {L.LatLng[]} Array de puntos que forman el cono.
     */
    function generarCono(latlng, angulo, apertura, radio) {
        const puntos = [latlng]; // El primer punto es el centro del radar
        const pasos = 30; // N칰mero de segmentos para dibujar el arco
        const inicio = angulo - apertura / 2;
        const fin = angulo + apertura / 2;

        for (let i = 0; i <= pasos; i++) {
            // Calcular el 치ngulo del punto actual en radianes
            const theta = degToRad(inicio + ((fin - inicio) * i) / pasos);
            
            // Calcular el desplazamiento en coordenadas locales
            const dx = radio * Math.sin(theta);
            const dy = -radio * Math.cos(theta);
            
            // Convertir el desplazamiento a coordenadas geogr치ficas (lat/lng)
            const destino = L.latLng(
                latlng.lat + (180 / Math.PI) * (dy / 6378137), // 6378137 es el radio de la Tierra en metros
                latlng.lng + (180 / Math.PI) * (dx / 6378137) / Math.cos(latlng.lat * Math.PI / 180)
            );
            puntos.push(destino);
        }
        return puntos;
    }

    // Dibujar 4 conos direccionales en el mapa
    const direcciones = [0, 90, 180, 270]; // Norte, Este, Sur, Oeste
    const apertura = 54; // grados
    const alcance = 1200; // metros

    direcciones.forEach(direccion => {
        const cono = generarCono(L.latLng(radarLat, radarLng), direccion, apertura, alcance);
        L.polygon(cono, {
            color: 'red',
            fillColor: 'red',
            fillOpacity: 0.25,
            weight: 1
        }).addTo(map);
    });

    // Datos de una detecci칩n simulada (esto vendr칤a de una API en un escenario real)
    const deteccion = {
        lat: radarLat + 0.002,
        lng: radarLng + 0.003,
        frecuencia: "2.4 GHz",
        intensidad: "Alta",
        antena: "Norte",
        hora: "12:43:01"
    };

    // Colocar el marcador del dron detectado
    L.marker([deteccion.lat, deteccion.lng], { icon: dronIcon })
        .addTo(map)
        .bindPopup(`
            游띶 <b>Detecci칩n de dron</b><br>
            Hora: ${deteccion.hora}<br>
            Frecuencia: ${deteccion.frecuencia}<br>
            Intensidad: ${deteccion.intensidad}<br>
            Antena: ${deteccion.antena}
        `);

    // Dibujar una l칤nea que conecte el radar con el dron para mostrar la detecci칩n
    L.polyline([[radarLat, radarLng], [deteccion.lat, deteccion.lng]], {
        color: 'red',
        weight: 2,
        dashArray: '5, 5'
    }).addTo(map);
</script>

</body>
</html>
