<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Radar Pasivo TP541</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    const radarLat = -33.447867318202256;
    const radarLng = -70.65718192524163;
    const map = L.map('map').setView([radarLat, radarLng], 16);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Radar Pasivo OSINT'
    }).addTo(map);

    // √çcono radar
    const radarIcon = L.icon({
      iconUrl: 'https://cdn-icons-png.flaticon.com/512/1115/1115998.png',
      iconSize: [32, 32],
      iconAnchor: [16, 16]
    });

    // √çcono dron
    const droneIcon = L.icon({
      iconUrl: 'https://cdn-icons-png.flaticon.com/512/201/201623.png',
      iconSize: [28, 28],
      iconAnchor: [14, 14]
    });

    // Marcador radar
    L.marker([radarLat, radarLng], { icon: radarIcon }).addTo(map).bindPopup('üì° Radar Pasivo TP541');

    // C√≠rculo de cobertura
    L.circle([radarLat, radarLng], {
      radius: 1200,
      color: 'green',
      fillOpacity: 0.05
    }).addTo(map).bindPopup('Cobertura 1.2 km');

    // Conos de cobertura
    const antennas = [
      { angle: 285, color: 'red' }, // O-NO
      { angle: 339, color: 'red' }, // Norte
      { angle: 93,  color: 'red' }, // Este
      { angle: 147, color: 'red' }  // SE
    ];

    function drawCone(lat, lng, angle, aperture, color) {
      const radius = 1.2; // km
      const points = [[lat, lng]];
      const steps = 30;
      const start = angle - aperture / 2;
      const end = angle + aperture / 2;
      const delta = (end - start) / steps;

      for (let i = 0; i <= steps; i++) {
        const a = (start + i * delta) * Math.PI / 180;
        const dx = radius * Math.cos(a) / 111.32;
        const dy = radius * Math.sin(a) / 111.32;
        points.push([lat + dy, lng + dx]);
      }

      L.polygon(points, {
        color,
        fillColor: color,
        fillOpacity: 0.25,
        weight: 1
      }).addTo(map);
    }

    antennas.forEach(({ angle, color }) => {
      drawCone(radarLat, radarLng, angle, 54, color);
    });

    // ZONA CIEGA - hacia la Torre Entel (23¬∞ aprox)
    drawCone(radarLat, radarLng, 23, 25, 'gray');

    // Marcador dron m√≥vil
    let droneMarker = L.marker([radarLat, radarLng], { icon: droneIcon }).addTo(map).bindPopup('üõ∏ Dron patrullando');
    let angle = 0;

    setInterval(() => {
      angle += 2;
      const radiusKm = 0.6;
      const latOffset = radiusKm * Math.cos(angle * Math.PI / 180) / 111.32;
      const lngOffset = radiusKm * Math.sin(angle * Math.PI / 180) / (111.32 * Math.cos(radarLat * Math.PI / 180));
      const newLat = radarLat + latOffset;
      const newLng = radarLng + lngOffset;
      droneMarker.setLatLng([newLat, newLng]);
    }, 250);

  </script>
</body>
</html>
